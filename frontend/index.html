<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÖÿ≥ÿ™ŸàÿØÿπ ŸÖŸÑÿÆÿµÿßÿ™ ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨ üéì</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --primary-color: #007bff;
            --light-bg: #f8f9fa;
            --dark-text: #1a1a1a;
            --border-color: #ddd;
        }
        
        /* 1. ÿ•ÿπÿØÿßÿØÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ© */
        html { box-sizing: border-box; }
        *, *:before, *:after { box-sizing: inherit; }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--light-bg);
            color: var(--dark-text);
            margin: 0;
            padding: 0;
            direction: rtl;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            position: relative;
            overflow-x: hidden; 
        }

        /* 2. ÿßŸÑŸáŸäÿØÿ± */
        .main-header {
            background-color: #ffffff;
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-bottom: 3px solid #f0f0f0; 
        }
        .logo {
            font-size: 1.8em;
            color: var(--primary-color);
            font-weight: 800; 
        }
        .btn-upload {
            background-color: var(--primary-color);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
        }
        .btn-upload:hover { background-color: #0056b3; }

        /* 3. ÿ£ŸÇÿ≥ÿßŸÖ ÿßŸÑÿßŸÜÿ≥Ÿäÿßÿ®Ÿäÿ© */
        
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .browse-section, .files-section {
            background-color: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.05);
            margin-top: 30px;
            width: 100%;
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        .section-hidden { display: none; }
        .section-hiding { opacity: 0; transform: translateX(30px); }
        .section-showing { opacity: 0; transform: translateX(-30px); }
        
        .browse-section h2 {
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            font-weight: 700;
        }
        .colleges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px;
        }
        .college-card {
            background-color: #f0f8ff; 
            border: none; 
            border-radius: 12px; 
            padding: 25px;
            text-align: right; 
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            position: relative;
            overflow: hidden;
        }
        .college-card::before { 
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 10px; 
            height: 100%;
            background-color: var(--primary-color); 
        }
        .college-card:hover {
            transform: translateY(-8px); 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); 
        }
        .college-card:active {
            transform: scale(0.97);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .college-card h3 {
            margin-top: 5px;
            margin-bottom: 5px;
            color: var(--dark-text); 
            font-size: 1.5em;
        }
        .college-card p { color: #6c757d; font-size: 0.9em; }

        /* 4. ŸÇÿ≥ŸÖ ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÑŸÅÿßÿ™ */
        .files-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }
        .header-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        
        .year-filter-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap; 
        }
        .year-filter-container select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            min-width: 200px; 
        }

        .back-btn {
            background: none;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        .back-btn:hover { background-color: var(--primary-color); color: white; }

        #summariesList {
            transition: opacity 0.2s ease-out;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            background-color: #fff;
            transition: all 0.2s ease-in-out;
            animation: fadeInSlideUp 0.4s ease-out;
            flex-wrap: wrap; 
        }
        .file-item:hover {
             box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
             transform: translateX(-5px);
             border-right: 5px solid var(--primary-color); 
        }

        .file-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            flex-grow: 1; 
        }
        .file-info span:first-child { font-size: 1.1em; font-weight: bold; }
        .file-info .uploader { font-size: 0.9em; font-weight: normal; color: #6c757d; }
        .uploader strong { color: var(--primary-color); }

        .file-actions {
            display: flex;
            align-items: center;
            gap: 10px; 
            flex-shrink: 0; 
        }

        .btn-download {
            background-color: #28a745; 
            color: white;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }
        .btn-download:hover { background-color: #1e7e34; }
        
        .btn-report {
            background-color: #f0ad4e; 
            color: white;
            padding: 8px 10px;
            border: none;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .btn-report:hover {
            background-color: #ec971f;
        }
        
        .btn-preview {
            background-color: #5bc0de;
            color: white;
            padding: 8px 10px;
            border: none;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .btn-preview:hover {
            background-color: #31b0d5;
        }
        
        
        /* 5. ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© (Modal) ŸÑŸÑÿ±ŸÅÿπ */
        .modal {
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s linear 0.3s;
        }
        .modal.show {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 600px;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        .close-btn {
            color: #aaa;
            position: absolute;
            left: 15px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .upload-form .form-group { margin-bottom: 15px; }
        .upload-form label { display: block; margin-bottom: 5px; font-weight: bold; }
        .upload-form input,
        .upload-form select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
        }
        .upload-form select:disabled { background-color: #e9ecef; color: #6c757d; cursor: not-allowed; }
        .upload-form input[type="file"] { background-color: #fff; }
        .upload-form .btn-submit {
            background-color: #28a745;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            width: 100%;
        }

        /* (ÿ¨ÿØŸäÿØ) ÿ™ŸÜÿ≥ŸäŸÇ ÿµŸÜÿØŸàŸÇ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± (Checkbox) */
        .upload-form .form-group-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            background-color: #f0f8ff;
            padding: 10px;
            border-radius: 5px;
            border-right: 4px solid var(--primary-color);
        }
        .upload-form .form-group-checkbox input {
            width: auto; /* ŸÑÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑŸÉÿßŸÖŸÑ */
            flex-shrink: 0;
        }
        .upload-form .form-group-checkbox label {
            margin-bottom: 0; /* ŸÑÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸáÿßŸÖÿ¥ */
            font-weight: normal;
            font-size: 0.95em;
        }

        /* 6. ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ (Loader Ÿà Empty State) */
        .loader {
            border: 5px solid #f3f3f3; 
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            background-color: #fdfdfd;
            border-radius: 8px;
            border: 1px dashed #ccc;
            color: #6c757d;
            margin-top: 20px;
            animation: fadeInSlideUp 0.4s ease-out;
        }
        .empty-state h3 { color: var(--dark-text); margin-top: 0; margin-bottom: 10px; }

        /* 7. ÿßŸÑÿ™ŸàÿßŸÅŸÇŸäÿ© (Responsive) */
        @media (max-width: 768px) {
            .logo { font-size: 1.5em; }
            .files-header { flex-direction: column; align-items: flex-start; }
            .header-buttons { width: 100%; flex-direction: column; gap: 10px; }
            .header-buttons .btn-upload,
            .header-buttons .back-btn { width: 100%; text-align: center; }
            .modal-content { width: 95%; margin: 5% auto; padding: 20px; }
            .college-card:hover { transform: none; }
            
            .file-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .file-info { width: 100%; }
            .file-actions { width: 100%; }
        }
        
        @media (max-width: 576px) {
            .logo { font-size: 1.2em; }
            .year-filter-container { flex-direction: column; align-items: flex-start; gap: 5px; width: 100%; }
            .year-filter-container select { width: 100%; min-width: auto; }
            
            .file-actions {
                width: 100%;
                flex-direction: column;
            }
            .btn-download, .btn-report, .btn-preview { 
                width: 100%;
                text-align: center;
            }
        }

        /* 8. ÿßŸÑŸÅŸàÿ™ÿ± (Footer) */
        .main-footer-credit {
            text-align: center;
            padding: 25px 15px;
            margin-top: 40px;
            background-color: #ffffff;
            border-top: 1px solid #eee;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.06);
        }
        .main-footer-credit p {
            margin: 8px 0;
            color: #333;
            font-size: 1em;
            font-weight: 500;
        }
        .main-footer-credit a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
        }
        .main-footer-credit a:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        
        /* 9. ÿ™ŸÜÿ≥ŸäŸÇÿßÿ™ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖÿπÿßŸäŸÜÿ© */
        .modal-content-preview {
            background-color: #fefefe;
            margin: 5% auto; 
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            width: 90%; 
            max-width: 900px; 
            position: relative;
        }
        #previewContent {
            width: 100%;
            height: 70vh; 
            border: 1px solid #ccc;
            background-color: #eee;
        }
        #previewContent iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        #previewContent .preview-error {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.2em;
            color: #777;
            font-weight: bold;
            text-align: center;
            padding: 10px;
        }
        #previewContent img {
            width: 100%;
            height: 100%; 
            object-fit: contain; 
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="logo">ŸÖÿ≥ÿ™ŸàÿØÿπ ŸÖŸÑÿÆÿµÿßÿ™ ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨ üéì</div>
    </header>

    <div class="container">
        
        <section id="browseSection" class="browse-section">
            <h2>üìö ÿ™ÿµŸÅÿ≠ ÿ≠ÿ≥ÿ® ÿßŸÑŸÉŸÑŸäÿ©</h2>
            <div class="colleges-grid">
                <div class="college-card" data-college-name="ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿßÿ™ ŸàÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™" data-uni-id="sohag" data-college-id="cs">
                    <h3>üíª ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿßÿ™ ŸàÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™</h3>
                    <p>ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨</p>
                </div>
                <div class="college-card" data-college-name="ŸÉŸÑŸäÿ© ÿßŸÑŸáŸÜÿØÿ≥ÿ©" data-uni-id="sohag" data-college-id="eng">
                    <h3>‚öôÔ∏è ŸÉŸÑŸäÿ© ÿßŸÑŸáŸÜÿØÿ≥ÿ©</h3>
                    <p>ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨</p>
                </div>
                <div class="college-card" data-college-name="ŸÉŸÑŸäÿ© ÿßŸÑÿ™ÿ¨ÿßÿ±ÿ©" data-uni-id="sohag" data-college-id="commerce">
                    <h3>üìä ŸÉŸÑŸäÿ© ÿßŸÑÿ™ÿ¨ÿßÿ±ÿ©</h3>
                    <p>ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨</p>
                </div>
                <div class="college-card" data-college-name="ŸÉŸÑŸäÿ© ÿßŸÑÿ¢ÿØÿßÿ®" data-uni-id="sohag" data-college-id="arts">
                    <h3>üìú ŸÉŸÑŸäÿ© ÿßŸÑÿ¢ÿØÿßÿ®</h3>
                    <p>ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨</p>
                </div>
                 <div class="college-card" data-college-name="ŸÉŸÑŸäÿ© ÿßŸÑÿ∑ÿ®" data-uni-id="sohag" data-college-id="medicine">
                    <h3>ü©∫ ŸÉŸÑŸäÿ© ÿßŸÑÿ∑ÿ®</h3>
                    <p>ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨</p>
                </div>
                 <div class="college-card" data-college-name="ŸÉŸÑŸäÿ© ÿßŸÑÿ™ÿ±ÿ®Ÿäÿ©" data-uni-id="sohag" data-college-id="edu">
                    <h3>üë©‚Äçüè´ ŸÉŸÑŸäÿ© ÿßŸÑÿ™ÿ±ÿ®Ÿäÿ©</h3>
                    <p>ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨</p>
                </div>
            </div>
        </section>

        <section id="filesSection" class="files-section section-hidden">
            <div class="files-header">
                <h2 id="collegeTitle">ÿßÿ≥ŸÖ ÿßŸÑŸÉŸÑŸäÿ©</h2>
                <div class="header-buttons">
                    <button id="uploadToThisCollegeBtn" class="btn-upload">‚¨ÜÔ∏è ÿßÿ±ŸÅÿπ ŸÖŸÑÿÆÿµ ŸÑŸáÿ∞Ÿá ÿßŸÑŸÉŸÑŸäÿ©</button>
                    <button id="backToBrowse" class="back-btn">ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÉŸÑŸäÿßÿ™ &larr;</button>
                </div>
            </div>
            
            <div class="year-filter-container">
                <label for="yearFilter">ÿ™ÿµŸÅŸäÿ© ÿ≠ÿ≥ÿ® ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ©:</label>
                <select id="yearFilter">
                    <option value="" disabled selected>--- ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ±ŸÇÿ© ---</option>
                    <option value="Year 1">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿ£ŸàŸÑŸâ</option>
                    <option value="Year 2">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©</option>
                    <option value="Year 3">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©</option>
                    <option value="Year 4">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ©</option>
                    <option value="Year 5">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿÆÿßŸÖÿ≥ÿ© (ÿ•ŸÜ Ÿàÿ¨ÿØÿ™)</option>
                </select>
            </div>
            
            <p>ÿ±ÿ®ŸÜÿß Ÿäÿ¨ŸÑŸá ŸÅŸä ŸÖŸäÿ≤ÿßŸÜ ÿ≠ÿ≥ŸÜÿßÿ™ŸÉ‚ù§Ô∏è. (ŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÑŸÅÿå ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ≤ÿ± "ÿ™ÿ≠ŸÖŸäŸÑ").</p>
            
            <div id="summariesList">
                </div>
        </section>

    </div> 
    
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close-btn">&times;</span>
            <h2>‚¨ÜÔ∏è ÿ±ŸÅÿπ ŸÖŸÑÿÆÿµ ÿ¨ÿØŸäÿØ</h2>
            <p>ÿ≥ÿßŸáŸÖ ŸÖÿπŸÜÿß ŸÅŸä ÿ•ÿ´ÿ±ÿßÿ° ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÑÿ≤ŸÖŸÑÿßÿ¶ŸÉ.</p>
            
            <form id="uploadForm" class="upload-form">
                 <div class="form-group">
                    <label for="university">ÿßŸÑÿ¨ÿßŸÖÿπÿ©:</label>
                    <select id="university" name="university" disabled>
                        <option value="sohag">ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="college">ÿßŸÑŸÉŸÑŸäÿ©:</label>
                    <select id="college" name="college" disabled>
                        <option value="cs">ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿßÿ™ ŸàÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™</option>
                        <option value="eng">ŸÉŸÑŸäÿ© ÿßŸÑŸáŸÜÿØÿ≥ÿ©</option>
                        <option value="commerce">ŸÉŸÑŸäÿ© ÿßŸÑÿ™ÿ¨ÿßÿ±ÿ©</option>
                        <option value="arts">ŸÉŸÑŸäÿ© ÿßŸÑÿ¢ÿØÿßÿ®</option>
                        <option value="medicine">ŸÉŸÑŸäÿ© ÿßŸÑÿ∑ÿ®</option>
                        <option value="edu">ŸÉŸÑŸäÿ© ÿßŸÑÿ™ÿ±ÿ®Ÿäÿ©</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="year">ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ©:</label>
                    <select id="year" name="year" required>
                        <option value="" disabled selected>--- ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ±ŸÇÿ© ---</option>
                        <option value="Year 1">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿ£ŸàŸÑŸâ</option>
                        <option value="Year 2">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©</option>
                        <option value="Year 3">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©</option>
                        <option value="Year 4">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ©</option>
                        <option value="Year 5">ÿßŸÑŸÅÿ±ŸÇÿ© ÿßŸÑÿÆÿßŸÖÿ≥ÿ© (ÿ•ŸÜ Ÿàÿ¨ÿØÿ™)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="uploaderName">ÿßÿ≥ŸÖŸÉ/ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä):</label>
                    <input type="text" id="uploaderName" name="uploaderName" placeholder="ÿ≥Ÿäÿ∏Ÿáÿ± ÿßÿ≥ŸÖŸÉ ÿ®ÿ¨Ÿàÿßÿ± ÿßŸÑŸÖŸÑÿÆÿµ" style="background-color: #fff;">
                </div>
                 <div class="form-group">
                    <label for="subject" >ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßÿØÿ©:</label>
                    <input type="text" id="subject" name="subject" placeholder="ŸÖÿ´ÿßŸÑ: ŸÇŸàÿßÿπÿØ ÿ®ŸäÿßŸÜÿßÿ™ 1" required style="background-color: #fff;">
                </div>
                <div class="form-group">
                    <label for="fileUpload">ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ (ÿ£Ÿà ÿπÿØÿ© ÿµŸàÿ± ŸÑÿ™ÿ≠ŸàŸäŸÑŸáÿß ŸÑŸÄ PDF):</label>
                    <input type="file" id="fileUpload" name="fileUpload" required 
                           multiple 
                           accept="image/*,.pdf,.doc,.docx,.zip,.rar">
                </div>
                
                <div class="form-group-checkbox">
                    <input type="checkbox" id="combineImages" name="combineImages">
                    <label for="combineImages">ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ± ÿßŸÑŸÖÿ≠ÿØÿØÿ© ÿ•ŸÑŸâ ŸÖŸÑŸÅ PDF Ÿàÿßÿ≠ÿØ</label>
                </div>
                
                <button type="submit" class="btn-submit">‚úîÔ∏è ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ</button>
            </form>
        </div>
    </div>

    <div id="previewModal" class="modal">
        <div class="modal-content-preview">
            <span id="closePreviewModal" class="close-btn">&times;</span>
            <h2 id="previewTitle">ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÖŸÑŸÅ</h2>
            <div id="previewContent">
                </div>
        </div>
    </div>

    <footer class="main-footer-credit">
        <p>ÿ™ŸÖ ÿßŸÑÿ™ÿµŸÖŸäŸÖ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿßŸÑÿ∑ÿßŸÑÿ®: ŸÖÿ≠ŸÖŸàÿØ ÿπÿ®ÿØÿßŸÑŸÖŸÜÿπŸÖ</p>
        <p>
            <a href="https://www.facebook.com/profile.php?id=100033684380260" target="_blank" rel="noopener noreferrer">
                &#x1F4F1; ÿ™ÿßÿ®ÿπŸÜŸä ÿπŸÑŸâ ŸÅŸäÿ≥ÿ®ŸàŸÉ 
            </a>
        </p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- 1. ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ---
            var modal = document.getElementById("uploadModal");
            var closeBtn = document.getElementById("closeModal");
            var uploadForm = document.getElementById("uploadForm");
            var browseSection = document.getElementById("browseSection");
            var filesSection = document.getElementById("filesSection");
            var collegeCards = document.querySelectorAll(".college-card");
            var backBtn = document.getElementById("backToBrowse");
            var collegeTitle = document.getElementById("collegeTitle");
            var uploadToCollegeBtn = document.getElementById("uploadToThisCollegeBtn");
            const summariesList = document.getElementById('summariesList');
            const yearFilter = document.getElementById('yearFilter'); 
            var uniSelect = document.getElementById("university");
            var collegeSelect = document.getElementById("college");
            var yearSelect = document.getElementById("year");
            var uploaderNameInput = document.getElementById("uploaderName");
            var currentSelectedCollegeId = null;
            var currentSelectedUniId = null;

            var previewModal = document.getElementById("previewModal");
            var closePreviewBtn = document.getElementById("closePreviewModal");
            var previewContent = document.getElementById("previewContent");
            var previewTitle = document.getElementById("previewTitle");

            // --- 2. Ÿàÿ∏ŸäŸÅÿ© ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ---
            async function fetchSummaries(collegeId, yearId) {
                summariesList.style.opacity = '0.5'; 
                setTimeout(() => {
                    summariesList.innerHTML = '<div class="loader"></div>';
                    summariesList.style.opacity = '1';
                }, 200); 

                try {
                    // !! (ÿ™ŸÜÿ®ŸäŸá) Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿ≥Ÿäÿ™ÿ∫Ÿäÿ± ÿπŸÜÿØ ÿßŸÑÿ±ŸÅÿπ
                    const response = await fetch(`http://localhost:5000/api/summaries/${collegeId}/${yearId}`);
                    const summaries = await response.json();
                    summariesList.style.opacity = '0';
                    
                    setTimeout(() => { 
                        summariesList.innerHTML = ''; 
                        
                        if (!response.ok || summaries.length === 0) {
                            let msgTitle = !response.ok ? "‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£" : "üòï ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÑÿÆÿµÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ©";
                            let msgBody = !response.ok ? "ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÄ API ÿßŸÑÿ¨ŸÑÿ®. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπŸÖŸÑ ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ±." : "ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ŸÅÿπ ÿ£Ÿä ŸÖŸÑŸÅÿßÿ™ ŸÑŸáÿ∞Ÿá ÿßŸÑŸÅÿ±ŸÇÿ© ÿ®ÿπÿØ. ŸÉŸÜ ÿ£ŸàŸÑ ŸÖŸÜ Ÿäÿ≥ÿßŸáŸÖ!";
                            
                            summariesList.innerHTML = `
                                <div class="empty-state">
                                    <h3>${msgTitle}</h3>
                                    <p>${msgBody}</p>
                                </div>
                            `;
                        } else {
                            summaries.forEach(summary => {
                                const date = new Date(summary.uploadDate).toLocaleDateString('ar-EG', { day: 'numeric', month: 'long', year: 'numeric' });
                                
                                const fileItem = document.createElement('div');
                                fileItem.className = 'file-item';
                                const fileInfo = document.createElement('div');
                                fileInfo.className = 'file-info';
                                fileInfo.innerHTML = `
                                    <span>${summary.subject}</span>
                                    <span class="uploader">
                                        ÿßŸÑŸÖÿ≥ÿßŸáŸÖ: <strong>${summary.uploaderName || 'ŸÖÿ≥ÿßŸáŸÖ ŸÖÿ¨ŸáŸàŸÑ'}</strong> | ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ±ŸÅÿπ: ${date}
                                    </span>
                                `;
                                
                                const fileActions = document.createElement('div');
                                fileActions.className = 'file-actions';
                                const safeSubject = summary.subject.replace(/"/g, '&quot;');
                                const safeUploader = (summary.uploaderName || 'ŸÖÿ≥ÿßŸáŸÖ ŸÖÿ¨ŸáŸàŸÑ').replace(/"/g, '&quot;');
                                
                                // ==========================================
                                //  ** üåü ÿßŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ŸáŸÜÿß üåü **
                                // (ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ© ŸÖŸÜ ÿßŸÑÿ®ÿßŸÉ ÿ•ŸÜÿØ ÿ®ÿπÿØ ÿ™ÿπÿØŸäŸÑ Cloudinary)
                                
                                // (ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÇÿØŸäŸÖ ŸÉÿßŸÜ: const fileURL = `http://localhost:5000/uploads/${summary.fileName}`;)
                                
                                // (ÿßŸÑŸÉŸàÿØ ÿßŸÑÿ¨ÿØŸäÿØ)
                                // ÿ®ŸÜŸÇÿ±ÿ£ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸàÿßŸÑÿßÿ≥ŸÖ ÿ≤Ÿä ŸÖÿß ÿßŸÑÿ®ÿßŸÉ ÿ•ŸÜÿØ ÿ®ÿπÿ™ŸáŸÖ (ÿ®ÿπÿØ ŸÖÿß ÿ≠ŸÅÿ∏ŸáŸÖ ŸÖŸÜ ŸÉŸÑÿßŸàÿØŸäŸÜÿßÿ±Ÿä)
                                const fileURL = summary.fileUrl;     // <-- ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ¨ÿØŸäÿØ ŸÖŸÜ ŸÉŸÑÿßŸàÿØŸäŸÜÿßÿ±Ÿä
                                const fileName = summary.fileName;   // <-- ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ£ÿµŸÑŸä ŸÑŸÑŸÖŸÑŸÅ

                                // (ŸÖŸÑÿ≠Ÿàÿ∏ÿ©: ÿ™ÿ£ŸÉÿØ ÿ£ŸÜ "fileUrl" Ÿà "fileName" ŸáŸÖÿß ŸÜŸÅÿ≥ ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° ŸÅŸä ÿßŸÑŸÖŸàÿØŸäŸÑ ÿ®ÿ™ÿßÿπŸÉ)
                                // ==========================================

                                fileActions.innerHTML = `
                                    <a href="${fileURL}" target="_blank" class="btn-download">
                                        ‚¨áÔ∏è ÿ™ÿ≠ŸÖŸäŸÑ
                                    </a>
                                    <button class="btn-report report-trigger-btn" 
                                            data-subject="${safeSubject}" 
                                            data-filename="${fileName}" 
                                            data-uploader="${safeUploader}">
                                        ‚ö†Ô∏è ÿ•ÿ®ŸÑÿßÿ∫
                                    </button>
                                    <button class="btn-preview preview-trigger-btn" 
                                            data-file-url="${fileURL}" 
                                            data-file-name="${fileName}">
                                        üëÅÔ∏è ŸÖÿπÿßŸäŸÜÿ©
                                    </button>
                                `;
                                
                                fileItem.appendChild(fileInfo);
                                fileItem.appendChild(fileActions);
                                summariesList.appendChild(fileItem);
                            });
                        }
                        summariesList.style.opacity = '1'; 
                    }, 200); 

                } catch (error) {
                    console.error('Error fetching summaries:', error);
                    summariesList.style.opacity = '0';
                    setTimeout(() => {
                         summariesList.innerHTML = `
                            <div class="empty-state">
                                <h3>üîå ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ</h3>
                                <p>ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑŸÉ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ Ÿàÿ£ŸÜ ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ± ŸäÿπŸÖŸÑ.</p>
                            </div>
                        `;
                        summariesList.style.opacity = '1';
                    }, 200);
                }
            }
            
            // --- 3. ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ŸÅÿπ (Modal) ---
            uploadToCollegeBtn.onclick = function() {
                uniSelect.value = 'sohag';
                collegeSelect.value = currentSelectedCollegeId;
                yearSelect.value = yearFilter.value; 
                uniSelect.disabled = true;
                collegeSelect.disabled = true;
                yearSelect.disabled = (yearFilter.value !== ''); 
                modal.classList.add('show');
            }

            function closeModal() {
                modal.classList.remove('show');
                setTimeout(() => {
                    yearSelect.disabled = false;
                    uploadForm.reset(); // ÿ•ŸÅÿ±ÿßÿ∫ ÿßŸÑŸÅŸàÿ±ŸÖ ÿπŸÜÿØ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
                    if(currentSelectedCollegeId && yearFilter.value) {
                        fetchSummaries(currentSelectedCollegeId, yearFilter.value);
                    }
                }, 300);
            }

            closeBtn.onclick = closeModal;
            

            // --- 3.1 Ÿàÿ∏ŸäŸÅÿ© ÿßŸÑÿ±ŸÅÿπ (ÿ™ŸÖ ŸÅÿµŸÑŸáÿß) ---
            async function uploadFile(formData, submitButton) {
                submitButton.innerText = "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ±ŸÅÿπ... Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±";
                submitButton.disabled = true;
                
                try {
                    // !! (ÿ™ŸÜÿ®ŸäŸá) Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿ≥Ÿäÿ™ÿ∫Ÿäÿ± ÿπŸÜÿØ ÿßŸÑÿ±ŸÅÿπ
                    const response = await fetch('http://localhost:5000/api/upload', {
                        method: 'POST',
                        body: formData 
                    });
                    
                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error || 'ŸÅÿ¥ŸÑ ÿßŸÑÿ±ŸÅÿπ');
                    }

                    const data = await response.json();
                    alert("ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ ÿ®ŸÜÿ¨ÿßÿ≠! ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÖÿ≥ÿßŸáŸÖÿ™ŸÉ."); 
                    closeModal(); 
                    submitButton.innerText = "‚úîÔ∏è ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ";
                    submitButton.disabled = false;
                    
                } catch (error) {
                    console.error('Error:', error);
                    alert("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ±ŸÅÿπ. ÿ™ÿ£ŸÉÿØ ÿ£ŸÜ ÿßŸÑÿ®ÿßŸÉ ÿ•ŸÜÿØ ŸäÿπŸÖŸÑ.");
                    submitButton.innerText = "‚úîÔ∏è ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ";
                    submitButton.disabled = false;
                }
            }

            // --- 3.2 ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ (ŸÖŸÜÿ∑ŸÇ ÿ¨ÿØŸäÿØ) ---
            uploadForm.onsubmit = async function(e) {
                e.preventDefault(); 
                
                const subject = document.getElementById("subject").value;
                const fileInput = document.getElementById("fileUpload");
                const year = document.getElementById("year").value;
                const uploaderName = uploaderNameInput.value; 
                const university = uniSelect.value; 
                const college = collegeSelect.value; 
                const submitButton = uploadForm.querySelector('.btn-submit');
                
                const combineCheckbox = document.getElementById("combineImages");
                const files = fileInput.files;
                const imageFiles = Array.from(files).filter(f => f.type.startsWith('image/'));

                if (!subject || !year || files.length === 0) {
                    alert("ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßÿØÿ© ŸàÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ© ŸàÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ Ÿàÿßÿ≠ÿØ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ.");
                    return;
                }

                // --- ŸÖŸÜÿ∑ŸÇ ÿØŸÖÿ¨ ÿßŸÑÿµŸàÿ± ---
                if (combineCheckbox.checked && imageFiles.length > 0) {
                    
                    submitButton.innerText = "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ± ÿ•ŸÑŸâ PDF...";
                    submitButton.disabled = true;

                    try {
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF();
                        
                        const readImage = (file) => {
                            return new Promise((resolve, reject) => {
                                const reader = new FileReader();
                                reader.onload = (e) => resolve(e.target.result);
                                reader.onerror = (e) => reject(e);
                                reader.readAsDataURL(file);
                            });
                        };

                        const imagesAsDataUrls = await Promise.all(imageFiles.map(readImage));

                        for (let i = 0; i < imagesAsDataUrls.length; i++) {
                            const imgData = imagesAsDataUrls[i];
                            
                            const getImgDimensions = (dataUrl) => {
                                return new Promise((resolve, reject) => {
                                    const img = new Image();
                                    img.onload = () => resolve({ width: img.width, height: img.height });
                                    img.onerror = reject;
                                    img.src = dataUrl;
                                });
                            };

                            const dims = await getImgDimensions(imgData);
                            
                            const pdfWidth = doc.internal.pageSize.getWidth();
                            const pdfHeight = doc.internal.pageSize.getHeight();
                            const ratio = Math.min(pdfWidth / dims.width, pdfHeight / dims.height);
                            const imgWidth = dims.width * ratio;
                            const imgHeight = dims.height * ratio;
                            
                            const x = (pdfWidth - imgWidth) / 2;
                            const y = (pdfHeight - imgHeight) / 2;
                            
                            if (i > 0) {
                                doc.addPage();
                            }
                            const format = imgData.split(';')[0].split('/')[1].toUpperCase();
                            doc.addImage(imgData, format, x, y, imgWidth, imgHeight); 
                        }
                        
                        const pdfBlob = doc.output('blob');
                        
                        const formData = new FormData();
                        formData.append('subject', subject);
                        formData.append('university', university);
                        formData.append('college', college);
                        formData.append('year', year);
                        formData.append('uploaderName', uploaderName); 
                        
                        const pdfFileName = subject.replace(/ /g, '_') + '.pdf';
                        formData.append('fileUpload', pdfBlob, pdfFileName);
                        
                        await uploadFile(formData, submitButton);

                    } catch (error) {
                        console.error('Error creating PDF:', error);
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ± ÿ•ŸÑŸâ PDF.');
                        submitButton.innerText = "‚úîÔ∏è ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ";
                        submitButton.disabled = false;
                    }

                } else {
                    // --- ÿßŸÑŸÖŸÜÿ∑ŸÇ ÿßŸÑŸÇÿØŸäŸÖ (ÿ±ŸÅÿπ ŸÖŸÑŸÅ Ÿàÿßÿ≠ÿØ) ---
                    if (files.length > 1) {
                        alert("ŸÑÿ±ŸÅÿπ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ŸÖŸÑŸÅÿå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿµŸàÿ± ŸÅŸÇÿ∑ Ÿàÿ™ŸÅÿπŸäŸÑ ÿÆŸäÿßÿ± 'ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ±'. ŸÑÿ±ŸÅÿπ ŸÖŸÑŸÅ Ÿàÿßÿ≠ÿØÿå ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑.");
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('subject', subject);
                    formData.append('university', university);
                    formData.append('college', college);
                    formData.append('year', year);
                    formData.append('uploaderName', uploaderName); 
                    formData.append('fileUpload', files[0]); 
                    
                    await uploadFile(formData, submitButton);
                }
            }

            // --- 4. ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖÿπÿßŸäŸÜÿ© (ŸÖÿ≠ÿØÿ´ÿ© ŸÑÿ™ÿØÿπŸÖ ÿßŸÑÿµŸàÿ±) ---
            function openPreviewModal(fileName, fileUrl) {
                previewTitle.innerText = "ŸÖÿπÿßŸäŸÜÿ©: " + fileName;
                const fileExtension = fileName.split('.').pop().toLowerCase();

                if (fileExtension === 'pdf') {
                    previewContent.innerHTML = `<iframe src="${fileUrl}"></iframe>`;
                
                } else if (['png', 'jpg', 'jpeg', 'gif', 'webp', 'bmp'].includes(fileExtension)) {
                    previewContent.innerHTML = `<img src="${fileUrl}" alt="ŸÖÿπÿßŸäŸÜÿ© ${fileName}">`;

                } else if (fileExtension === 'docx' || fileExtension === 'doc') {
                    const googleViewerUrl = `https://docs.google.com/gview?url=${encodeURIComponent(fileUrl)}&embedded=true`;
                    previewContent.innerHTML = `<iframe src="${googleViewerUrl}"></iframe>`;

                } else if (fileExtension === 'zip' || fileExtension === 'rar') {
                    previewContent.innerHTML = `<div class="preview-error">ŸÑÿß ŸäŸÖŸÉŸÜ ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑ÿ© (ZIP/RAR). Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅ.</div>`;
                    
                } else {
                    previewContent.innerHTML = `<div class="preview-error">ÿßŸÑŸÖÿπÿßŸäŸÜÿ© ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠ÿ© ŸÑŸáÿ∞ÿß ÿßŸÑŸÜŸàÿπ ŸÖŸÜ ÿßŸÑŸÖŸÑŸÅÿßÿ™.</div>`;
                }
                
                previewModal.classList.add('show');
            }


            function closePreviewModal() {
                previewModal.classList.remove('show');
                previewContent.innerHTML = '';
                previewTitle.innerText = 'ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÖŸÑŸÅ';
            }

            closePreviewBtn.onclick = closePreviewModal;
            
            // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿÆÿßÿ±ÿ¨Ÿáÿß
            window.addEventListener('click', function(event) {
                if (event.target == previewModal) {
                    closePreviewModal();
                }
                if (event.target == modal) { 
                    closeModal();
                }
            });
            
            // --- 5. ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿßŸÑÿ™ÿµŸÅÿ≠ ÿßŸÑÿßŸÜÿ≥Ÿäÿßÿ®Ÿä ---
            collegeCards.forEach(function(card) {
                card.onclick = function() {
                    var selectedCollegeName = card.getAttribute("data-college-name");
                    currentSelectedCollegeId = card.getAttribute("data-college-id");
                    currentSelectedUniId = card.getAttribute("data-uni-id");
                    
                    collegeTitle.innerText = "ŸÖŸÑÿÆÿµÿßÿ™: " + selectedCollegeName;
                    
                    browseSection.classList.add('section-hiding'); 
                    
                    setTimeout(() => {
                        browseSection.classList.add('section-hidden'); 
                        browseSection.classList.remove('section-hiding');
                        filesSection.classList.remove('section-hidden'); 
                        filesSection.classList.add('section-showing'); 
                        setTimeout(() => {
                            filesSection.classList.remove('section-showing'); 
                        }, 10);
                    }, 300); 

                    yearFilter.value = '';
                    summariesList.innerHTML = `
                        <div class="empty-state">
                            <h3>üëã ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ</h3>
                            <p>ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ© ŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖŸÑÿÆÿµÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©.</p>
                        </div>
                    `;
                }
            });
            
            // --- 6. ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ŸÑÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≥ŸÜÿ© ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ™ÿµŸÅŸäÿ© ---
            yearFilter.addEventListener('change', function() {
                const selectedYear = yearFilter.value;
                if (currentSelectedCollegeId && selectedYear) {
                    fetchSummaries(currentSelectedCollegeId, selectedYear);
                }
            });

            // --- 7. ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ± (ÿßŸÑÿ•ÿ®ŸÑÿßÿ∫ ŸàÿßŸÑŸÖÿπÿßŸäŸÜÿ©) ---
            summariesList.addEventListener('click', function(e) {
                
                // 7.1 ÿ≤ÿ± ÿßŸÑÿ•ÿ®ŸÑÿßÿ∫
                if (e.target && e.target.classList.contains('report-trigger-btn')) {
                    const button = e.target;
                    const subject = button.dataset.subject;
                    const filename = button.dataset.filename;
                    const uploader = button.dataset.uploader;
                    
                    // !!!!! == ÿ∂ÿπ ÿ±ŸÇŸÖŸÉ ŸáŸÜÿß == !!!!!
                    // (ŸáÿßŸÖ: ÿ∂ÿπ ÿßŸÑÿ±ŸÇŸÖ ÿ®ÿßŸÑÿµŸäÿ∫ÿ© ÿßŸÑÿØŸàŸÑŸäÿ©ÿå ŸÖÿ´ŸÑÿßŸã 201012345678)
                    const myWhatsAppNumber = "201012345678"; // <--- ŸÇŸÖ ÿ®ÿ™ÿ∫ŸäŸäÿ± Ÿáÿ∞ÿß ÿßŸÑÿ±ŸÇŸÖ
                    
                    const message = `
                        üö® **ÿ®ŸÑÿßÿ∫ ÿπŸÜ ŸÖÿ≠ÿ™ŸàŸâ ŸÖÿ≥Ÿäÿ°** üö®
                        
                        ŸÖÿ±ÿ≠ÿ®ÿßŸã ŸÖÿ≠ŸÖŸàÿØÿå
                        ÿ£ÿ±ŸäÿØ ÿßŸÑÿ•ÿ®ŸÑÿßÿ∫ ÿπŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿßŸÑŸä ÿπŸÑŸâ ŸÖŸàŸÇÿπ ŸÖŸÑÿÆÿµÿßÿ™ ÿ¨ÿßŸÖÿπÿ© ÿ≥ŸàŸáÿßÿ¨:
                        
                        - *ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßÿØÿ©:* ${subject}
                        - *ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÑŸÅ (ŸÑŸÑÿ≠ÿ∞ŸÅ):* ${filename}
                        - *ÿßŸÑŸÖÿ≥ÿßŸáŸÖ:* ${uploader}
                        
                        ÿ®ÿ±ÿ¨ÿßÿ° ŸÖÿ±ÿßÿ¨ÿπÿ© ÿßŸÑŸÖŸÑŸÅ Ÿàÿ≠ÿ∞ŸÅŸá.
                    `;
                    
                    const encodedMessage = encodeURIComponent(message);
                    const whatsappURL = `https://wa.me/${myWhatsAppNumber}?text=${encodedMessage}`;
                    window.open(whatsappURL, '_blank');
                }
                
                // 7.2 ÿ≤ÿ± ÿßŸÑŸÖÿπÿßŸäŸÜÿ©
                if (e.target && e.target.classList.contains('preview-trigger-btn')) {
                    const button = e.target;
                    const fileUrl = button.dataset.fileUrl;
                    const fileName = button.dataset.fileName;
                    
                    if ( (fileName.endsWith('.docx') || fileName.endsWith('.doc')) && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ) {
                        alert('ÿ™ŸÜÿ®ŸäŸá: ŸÖÿπÿßŸäŸÜÿ© ŸÖŸÑŸÅÿßÿ™ ŸàŸàÿ±ÿØ (Word) ŸÇÿØ ŸÑÿß ÿ™ÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠ ÿπŸÑŸâ ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ± ÿßŸÑŸÖÿ≠ŸÑŸä (localhost). ÿ≥ÿ™ÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ≥ŸÑŸäŸÖ ÿπŸÜÿØ ÿ±ŸÅÿπ ÿßŸÑŸÖŸàŸÇÿπ ÿπŸÑŸâ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™.');
                    }
                    
                    openPreviewModal(fileName, fileUrl);
                }
            });

            // --- 8. ÿ≤ÿ± ÿßŸÑÿπŸàÿØÿ© ÿßŸÑÿßŸÜÿ≥Ÿäÿßÿ®Ÿä ---
            backBtn.onclick = function() {
                filesSection.classList.add('section-hiding');
                setTimeout(() => {
                    filesSection.classList.add('section-hidden'); 
                    filesSection.classList.remove('section-hiding');
                    browseSection.classList.remove('section-hidden'); 
                    browseSection.classList.add('section-showing');
                    setTimeout(() => {
                        browseSection.classList.remove('section-showing');
                    }, 10);
                }, 300); 
                
                yearFilter.value = '';
                currentSelectedCollegeId = null;
                currentSelectedUniId = null;
            }

        });
    </script>
</body>
</html>